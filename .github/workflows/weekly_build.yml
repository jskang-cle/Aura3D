name: Weekly build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4.1.1

      # 生成版本号（保持不变）
      - name: Generate version number
        id: generate_version
        run: |
          DATE_VERSION=$(date +'%Y%m%d')
          VERSION="1.0.0-weekly.${DATE_VERSION}"
          echo "VERSION=${VERSION}" >> $GITHUB_OUTPUT

      # 修复打包命令：移除多余空格，参数紧凑拼接
      - name: Pack Aura3D.Core
        run: dotnet pack src/Aura3D.Core -o nugets -c Release /p:Version=${{ steps.generate_version.outputs.VERSION }}

      - name: Pack Aura3D.Avalonia
        run: dotnet pack src/Aura3D.Avalonia -o nugets -c Release /p:Version=${{ steps.generate_version.outputs.VERSION }}

      - name: Upload to Nuget
        run: dotnet nuget push "nugets/*.nupkg" --api-key ${{ secrets.NUGET_API_KEY }} --source https://api.nuget.org/v3/index.json --skip-duplicate
